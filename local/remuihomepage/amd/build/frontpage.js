define(["jquery","core/modal_factory","core/templates","core/str","core/modal_events","local_remuihomepage/sectionmanager","core/fragment","core/ajax","core/notification","theme_remui/events","theme_remui/html2canvas"],function(e,t,i,o,n,a,s,r,c,l,d){var u=-1,h=null,m=null,g=".home-sections button.section-visibility";function f(t,i){var o={dots:!1,arrows:!0,infinite:!1,speed:500,prevArrow:e("section[data-instance='"+t+"'] .button-container .btn-prev"),nextArrow:e("section[data-instance='"+t+"'] .button-container .btn-next"),rtl:"rtl"==e("html").attr("dir"),slidesToShow:4,slidesToScroll:4,responsive:[{breakpoint:1024,settings:{slidesToShow:3,slidesToScroll:3}},{breakpoint:800,settings:{slidesToShow:2,slidesToScroll:2}},{breakpoint:480,settings:{slidesToShow:1,slidesToScroll:1}}]};null!=i&&"object"==typeof i&&Object.assign(o,i);var n=a.getSectionElement(t);n.find(".available-courses").addClass("d-none"),0==n.find(".courses-slider .empty-courses-container").length&&(n.find(".courses-slider").slick(o).on("setPosition",function(t,i){e(n).find(".slick-slide > div").css("height","100%"),i.$slides.css("height",i.$slideTrack.height()+"px")}),n.find(".available-courses").removeClass("d-none"))}function p(e,t,o){a.showSectionLoader(e,!0);var n=a.getSectionElement(e);n.find(".courses-slider").removeClass("show"),r.call([{methodname:"local_remuihomepage_get_frontpage_section_courses_in_category",args:{instanceid:e,categoryid:t},done:function(t){t=JSON.parse(t),n.find(".courses-slider.slick-initialized.slick-slider").slick("unslick"),n.find(".courses-slider").empty(),n.data("totalcourses",t.totalcourse),n.data("current",0),i.render("local_remuihomepage/hs_courses_cards",t).done(function(t,a){i.appendNodeContents(n.find(".courses-slider"),t,a),f(e,{slidesToShow:3,slidesToScroll:3}),"function"==typeof o&&o()}).fail(c.exception),a.showSectionLoader(e,!1)},fail:function(t){a.showSectionLoader(e,!1),c.exception(t)}}])}e(document).ready(function(){e(".flash").hide();var t="https://share.edwiser.org/api/base64.php";e("#take_screenshot").click(function(t){t.preventDefault(),e(".flash").show().animate({opacity:.4},300).fadeOut(300).css({opacity:1}),e("#take_screenshot").html('<i class="fa fa-spinner fa-spin" aria-hidden="true"></i>'),n(),1==appearanimation&&""!=appearanimationstyle&&e(".home-sections section.panel, .default-sections.panel").removeClass(appearanimationstyle).removeClass("animation-slide-left").removeClass("animation-slide-right");for(var i,a,s=document.getElementById("videofixCanvas"),r=s.getContext("2d"),c=document.querySelectorAll("video"),l=0,d=c.length;l<d;l++){var u=c[l];try{i=u.videoWidth,a=u.videoHeight,s.width=i,s.height=a,r.fillRect(0,0,i,a),r.drawImage(u,0,0,i,a),u.style.backgroundImage="url('"+s.toDataURL()+"')",u.style.backgroundSize="cover",r.clearRect(0,0,0,0)}catch(t){continue}}setTimeout(o,2e3)});var i={logging:!1,useCORS:!0};function o(){d(document.querySelector(".page"),i).then(function(i){var o=i.toDataURL("image/jpeg",.95),n=new FormData;n.append("base64",o);var a=M.cfg.wwwroot.replace(/(^\w+:|^)\/\//,"");a=String(a).replace("#",""),a=String(a).replace("/",""),a=String(a).replace(".","-"),n.append("hash",a+"-"+Math.random().toString(36).substring(7)),e.ajax({url:t,type:"POST",crossDomain:!0,data:n,async:!0,cache:!1,contentType:!1,processData:!1,success:function(t){parsed=JSON.parse(t),"ok"==parsed.status?(e("section.take-screenshot").hide(),e("#take_screenshot").html("CAPTURE AGAIN"),e(".screenshot-container .screenshot").css("background","url("+parsed.url+")"),e(".delete-screenshot").attr("data-deleteurl",parsed.delete_url),e(".download-screenshot").attr("href",parsed.url),e(".preview-screenshot").attr("href",parsed.url),e("section.taken-screenshot").show(),e("a.social-facebook").attr("href","https://www.facebook.com/sharer/sharer.php?u="+parsed.url),e("a.social-twitter").attr("href","https://twitter.com/share?url="+parsed.url),e("a.social-linkedin").attr("href","https://www.linkedin.com/shareArticle?mini=true&url="+parsed.url)):(e(".failed-screenshot-message").html("Something went wrong!"),e("#take_screenshot").html("Capture Again"))},error:function(t,i,o){e(".failed-screenshot-message").html(o),e("#take_screenshot").html("CAPTURE AGAIN")}})})}function n(){e(".failed-screenshot-message").html(""),e(".screenshot-container .screenshot").css("background",""),e(".delete-screenshot").attr("data-deleteurl",""),e(".download-screenshot").attr("href",""),e(".preview-screenshot").attr("href",""),e("a.social-facebook").attr("href",""),e("a.social-linkedin").attr("href",""),e("a.social-twitter").attr("href","")}e(".delete-screenshot").click(function(t){var i=e(".delete-screenshot").data("deleteurl");n(),e("section.taken-screenshot").hide(),e("section.take-screenshot").show(),i&&e.ajax({url:i,type:"GET",dataType:"json",crossDomain:!0,async:!0})}),e("#screenshotShareModal").on("hidden.bs.modal",function(t){n(),e("section.taken-screenshot").hide(),e("section.take-screenshot").show()}),e("a.social-share ").click(function(t){t.preventDefault();var i=e(this),o=i.attr("href"),n=i.attr("data-network"),a={facebook:{width:600,height:300},twitter:{width:600,height:254},linkedin:{width:600,height:473}};!function(e){window.open(o,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height="+a[e].height+",width="+a[e].width)}(n)}),e(window).scroll(function(){if(e(".pagelayout-frontpage section.lazy-section").each(function(t){var i=e(this).position().top;if(e(window).scrollTop()+e(window).height()+2*e(window).height()>i&&e(this).is(".lazy-section")){e(this).removeClass("lazy-section");var o=e(this).data("instance"),n=a.getLoadedSection(o);a.reloadSection({success:!0,context:n},function(){e('.home-sections section[data-instance="'+o+'"]')})}else;}),e(".pagelayout-frontpage section.invisible").each(function(t){var i=e(this).position().top+100;e(window).scrollTop()+e(window).height()>i&&setTimeout(function(){e(this).removeClass("invisible"),1==appearanimation&&("animation-slide-left-right"==appearanimationstyle?e(this).prev().is(".animation-slide-left")?e(this).addClass("animation-slide-right"):e(this).addClass("animation-slide-left"):e(this).addClass(appearanimationstyle))}.bind(this),100)}),transparentheader){if(e("section[data-instance]:first-child").is(".section-slider"))if(e(window).scrollTop()<45)return void e("body.has-slider").addClass("animate-header");e("body.has-slider").removeClass("animate-header")}})}),e(document).on("slid.bs.carousel",".home-sections section .carousel",function(){var t=e(this).parent().data("instance");a.playSliderVideo(t)}),e(document).on("click",".editing-action",function(){var t=e('<form method="post"></form>');t.append("<input type='hidden' name='frontpageediting' value='1'/>"),t.append("<input type='hidden' name='editpage' value='"+e(this).data("edit")+"'/>"),e("body").append(t),t.submit()}),e(document).on("click",".publish",function(){var t=e('<form method="post"></form>');t.append("<input type='hidden' name='frontpageediting' value='1'/>"),t.append("<input type='hidden' name='publish' value='1'/>"),e("body").append(t),t.submit()}),e(document).on("click",".preview-section",function(){a.showAllSectionsLoader(),e(this).find("i").toggleClass("fa-eye fa-eye-slash");var t=e(this).find("i").is(".fa-eye-slash");if(e("body").toggleClass("preview",t),e(".settings,.publish,.add-section,.editing-action,.editing-alert").toggleClass("d-flex",!t).toggleClass("d-none",t),e("html, body").animate({scrollTop:0},e(window).scrollTop()/6),e(g+" .fa-eye-slash").parents("section[data-instance]").toggleClass("section-invisible",t),transparentheader)if(t){var i=e("body").find("section[data-instance]:not(.section-invisible)"),o=!1;i&&(o=e(i[0]).is(".section-slider")),e("body").toggleClass("has-slider animate-header",o)}else e("body").toggleClass("has-slider animate-header",e("body").find("section[data-instance]:first-child").is(".section-slider"));setTimeout(function(){a.hideAllSectionsLoader()},2e3)}),e(document).on(l.SECTION_ADDED+" "+l.SECTION_UPDATED,function(e){switch(e.configdata.sectionname){case"courses":var t=a.getSectionElement(e.configdata.id);if(t.is(".categoryandcourses-view")&&0!=e.configdata.catlist.length){var i=e.configdata.catlist[0].categoryid;p(e.configdata.id,i)}else f(t.data("instance"),{})}}),e("body").on("click",".home-sections .section-courses .category-list .category-item",function(){var t=e(this).parents("section[data-instance]").data("instance");e(this).parents("section[data-instance]").find(".courses-slider").removeClass("show"),p(t,e(this).data("id"),function(){e(this).siblings().removeClass("active"),e(this).addClass("active"),e(this).parents(".category-list").removeClass("show")}.bind(this))}),e("body").on("click",".home-sections .section-courses .category-list .site-skintools-toggle",function(){e(this).parents(".category-list").toggleClass("show")}).on("afterChange",'[data-sectionname="courses"].section-courses:not(.categories-view) .courses-slider',function(t,o,n){var s=e(this).closest('section[data-sectionname="courses"]');if(e(o.$nextArrow).is(".slick-disabled")){var l=e(s).is(".categoryandcourses-view")?e(s).find(".category-list .category-item.active").data("id"):0,d=s.data("instance"),u=s.data("totalcourses"),h=s.data("current");h+25<u&&r.call([{methodname:"local_remuihomepage_get_frontpage_section_courses_in_category",args:{instanceid:d,categoryid:l,start:h+25}}])[0].done(function(t){var n=0;a.showSectionLoader(d),t=JSON.parse(t),s.data("current",h+25),t.courses.forEach(function(s){i.render("theme_remui/course_card_grid",s).done(function(i,s){i="<div><div>"+i+"</div></div>",e(o.$slider).slick("slickAdd",i),++n==t.courses.length&&a.showSectionLoader(d,!1)}).fail(c.exception)})}).fail(c.exception)}}),e(document).on("click",".settings",function(){t.create({type:t.types.SAVE_CANCEL,title:M.util.get_string("homepagesettings","local_remuihomepage"),body:s.loadFragment("local_remuihomepage","frontpage_settings_form",u)},e("#create")).done(function(e){e.modal.addClass("modal-sidebar d-inline-flex editmodal"),e.show(),e.getRoot().on(n.save,function(t){t.preventDefault();var i=e.getRoot().find("form"),o=JSON.stringify(i.serialize());r.call([{methodname:"local_remuihomepage_save_frontpage_settings",args:{settings:o}}])[0].done(function(e){window.location.reload()}).fail(c.exception),e.hide()}),e.getRoot().on(n.hidden,function(){e.destroy()})})}),e(document).on("click",".sections-container div[class*='section-']",function(){var t=e(this).data("section");h.hide(),a.setSectionName(t),a.addSection()}),e("body").on("click",".moveup-section",function(){a.reorderSection(e(this).data("instance"),-1)}).on("click",".movedown-section",function(){a.reorderSection(e(this).data("instance"),1)}),e("body").on("click",g,function(){var t=e(this).data("instance"),i=e(this).data("visible");a.updateVisibility(t,!i)});var v=function(t){var i=e(t).attr("id").replace("id_block_","").replace("_style",""),o="#id_block_"+i+"_htmleditable ",n=e(t).val().replace(/(([\.\#]?[\w\d\_\-]+\s*)+\{)/,function(e){return o+e});e(t).next().is("#block-"+i+"-style")||e(t).after('<style id="block-'+i+'-style" type="text/css"></style>'),e(t).next().html(n)};e("body").on("input",".block-style textarea",function(){v(e(this))});function _(t){return e(t).attr("data-instance")}e("body").on("input",".separator-style select, .separator-style input",function(){!function(t){var i=e(t).find("#id_style").val(),o=e(t).find('[name="color"]').val(),n=e(t).find('[name="color2"]').val(),a=e(t).find("#id_height").val(),s={margin:"0px auto",width:e(t).find("#id_width").val()+"%"};switch(e(t).find('[name="color2"]').parents(".separator-style").toggleClass("d-none","gradient"!=i),i){case"blur":s.height="0px",s["background-image"]="none",s.border="1px solid "+o,s["box-shadow"]="0 0 "+a+"px "+a/2+"px "+o;break;case"blurend":s.background="none",s["box-shadow"]="none",s.border="none",s.height=a+"px",s["background-image"]="linear-gradient(to right, #ffffff, "+o+", #ffffff)";break;case"gradient":s["box-shadow"]="none",s["background-image"]="none",s.border="none",s.height=a+"px",s.background="linear-gradient(to right, "+o+" 0%, "+n+" 50%, "+o+" 100%)";break;default:s["box-shadow"]="none",s["background-image"]="none",s.height="0px",s["border-top"]=a+"px "+i+" "+o}e(t).find("#remui_separator_output").css(s)}(e(this).closest("form"))}),e("body").on("change",".updateform select",function(){var t=e(this).parents("form").find('[name="instanceid"]').val(),i=JSON.stringify(m.getRoot().find("form").serialize()),o=y(t,i);m.setBody(o)}),e(document).on("click",".home-sections button.edit-section",function(){var i=_(this),o=e(this).attr("data-sectionname");t.create({type:t.types.SAVE_CANCEL,title:"Edit "+o.charAt(0).toUpperCase()+o.slice(1)+" Section",body:y(i,null)}).then(function(t){m=t,t.modal.addClass("modal-sidebar d-inline-flex editmodal");var o=t.getRoot();o.on(n.save,function(e){e.preventDefault();var t=o.find("form");if("undefined"==typeof remui_section_form_validate||remui_section_form_validate(t)){var n=JSON.stringify(t.serialize());a.updateSection(i,n),m.hide()}}),o.on(n.hidden,function(){m.destroy(),e(document).find(".mform.atto_form.atto_media").parents(".moodle-dialogue-base").remove()}),t.show()})}),e(document).on("click",".home-sections button.delete-section",function(){var e=_(this);t.create({type:t.types.SAVE_CANCEL,title:"Delete item",body:"Do you really want to delete?"}).then(function(t){t.setSaveButtonText("Delete");var i=t.getRoot();i.on(n.save,function(){a.deleteInstance(e)}),i.on(n.hidden,function(){t.destroy()}),t.show()})}),e(document).on("click",".home-sections button.cancel-delete-section",function(){var e=_(this);a.deleteInstance(e,!1)}),e(document).on("click",".home-sections button.confirm-delete-section",function(){var e=_(this);a.deleteInstance(e,2)});var y=function(t,i){var o={instanceid:t};null!=i&&(o.formdata=i);var n=s.loadFragment("local_remuihomepage","frontpage_section_form",u,o);return n.done(function(t,i){setTimeout(function(){var t=e("body").find("form .block-style textarea");0!=t.length&&t.each(function(t,i){v(e(i))})},2e3)}),n},b=function(){!function(o){var n=e(".add-section");t.create({large:!0,body:i.render("local_remuihomepage/hs_sections_list",o)},n).then(function(e){h=e,e.setTitle(M.util.get_string("addsection","local_remuihomepage")),e.modal.addClass("modal-sidebar d-inline-flex"),e.modal.width("500px")}.bind(this)).fail(c.exception)}({sections:[{section:"slider",title:M.util.get_string("slidersection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/slider","local_remuihomepage")},{section:"aboutus",title:M.util.get_string("aboutussection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/aboutus","local_remuihomepage")},{section:"contact",title:M.util.get_string("contactsection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/contact","local_remuihomepage")},{section:"feature",title:M.util.get_string("featuresection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/feature","local_remuihomepage")},{section:"courses",title:M.util.get_string("coursessection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/courses","local_remuihomepage")},{section:"team",title:M.util.get_string("teamsection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/team","local_remuihomepage")},{section:"testimonial",title:M.util.get_string("testimonialsection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/testimonial","local_remuihomepage")},{section:"html",title:M.util.get_string("htmlsection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/html","local_remuihomepage")},{section:"separator",title:M.util.get_string("separatorsection","local_remuihomepage"),imageurl:M.util.image_url("screenshots/separator","local_remuihomepage")}]})};return{init:function(e,t){t&&b(),u=e,a.LoadAllSections()}}});