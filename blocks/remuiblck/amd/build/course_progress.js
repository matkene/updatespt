"use strict";define(["jquery","core/ajax","core/notification","block_remuiblck/jquery.dataTables","block_remuiblck/dataTables.bootstrap4","theme_remui/jquery-asPieProgress","theme_remui/aspieprogress"],function(t,r,n){var s,o={ROOT:"",TABLE:"#DataTables_Teacher",DATA_TABLE:"#DataTables_Teacher_wrapper",STUDENT_PROGRESS_ELEMENT:".student_progress_ele",STUDENT_PROGRESS_TABLE:"#wdmCourseProgressTable",COURSE_NAME:".wdm_course_name.has-student",MESSAGE_HIDDEN:"#messageidhidden",MESSAGE_AREA:"#messagearea",TOGGLE_DESCRIPTION:".toggle-desc",REVERT:"#courserevertbtn",CUSTOM_MESSAGE:".custom-message",MESSAGE_SEND:".send-message"},i=function(e,s,a,t){return r.call([{methodname:"block_remuiblck_get_course_progress_list",args:{search:e,length:s,start:a,order:t}}])[0]};function d(){t(o.ROOT).find(".pie-progress").asPieProgress({namespace:"pie-progress",speed:30,classes:{svg:"pie-progress-svg",element:"pie-progress",number:"pie-progress-number",content:"pie-progress-content"}})}function l(e,s){t.ajax({type:"GET",async:!0,url:M.cfg.wwwroot+"/theme/remui/request_handler.php?action=send_message_user_ajax&studentid="+e+"&message="+s+"&sesskey="+M.cfg.sesskey,success:function(e){t(root).find(o.MESSAGE_HIDDEN).val(""),t(root).find(o.MESSAGE_AREA).val(""),t(o.ROOT).find(".close-message").click()},error:function(e,s,a){t(o.ROOT).find("div#analysis-chart-area").hide()}})}function a(a){t("body").on("click",a+" "+o.COURSE_NAME,function(){var e=t(this).data("courseid");t(a).find(o.DATA_TABLE).hide(),function(e){t.ajax({type:"GET",async:!0,url:M.cfg.wwwroot+"/theme/remui/request_handler.php?action=get_course_progress_ajax&courseid="+e+"&sesskey="+M.cfg.sesskey,success:function(e){t(o.ROOT).find(o.STUDENT_PROGRESS_ELEMENT).empty(),t(o.ROOT).find(o.STUDENT_PROGRESS_ELEMENT).append(e),d(),s=t(o.ROOT).find(o.STUDENT_PROGRESS_TABLE).DataTable({scrollY:"300px",scrollCollapse:!0,paging:!1,retrieve:!0,lengthchange:!1,autoWidth:!0,scrollX:!0,search:"Fred",info:!1,language:{searchPlaceholder:"Search"},responsive:!0}),t(o.ROOT).find("div.dataTables_filter input").addClass("form-control"),t(o.ROOT).find("div.dataTables_length select").addClass("form-control")},error:function(e,s,a){console.log("we are not here "),t(o.ROOT).find("div#analysis-chart-area").hide()}})}(e)}).on("click",a+" "+o.REVERT,function(){s.destroy(),t(a).find(o.STUDENT_PROGRESS_ELEMENT).empty(),t(a).find(o.DATA_TABLE).show()}).on("click",a+" "+o.CUSTOM_MESSAGE,function(){var e=t(this).data("studentid");t(o.MESSAGE_HIDDEN).val(e)}).on("click",a+" "+o.MESSAGE_SEND,function(){var e=t(a).find(o.MESSAGE_HIDDEN).val(),s=t(a).find(o.MESSAGE_AREA).val();""!=s?l(e,s):t(o.MESSAGE_AREA).focus()}).on("click",o.STUDENT_PROGRESS_ELEMENT+" "+o.TOGGLE_DESCRIPTION,function(){t(this).toggleClass("fa-plus"),t(this).toggleClass("fa-minus"),t(this).parents(o.STUDENT_PROGRESS_ELEMENT).find(".panel-body").toggleClass("show")}),t(a+" "+o.TABLE).on("order.dt",function(){d()}),t(a+" "+o.STUDENT_PROGRESS_TABLE).on("order.dt",function(){d()}),o.ROOT=a}return{init:function(e){t(document).ready(function(){d(),function(e){t(e).show().find(o.TABLE).DataTable({paging:!0,pagingType:"simple_numbers",autoWidth:!0,scrollX:!0,bPaginate:!0,bServerSide:!0,language:{searchPlaceholder:M.util.get_string("search","moodle"),emptyTable:M.util.get_string("nomatchingcourses","core_backup"),lengthMenu:M.util.get_string("show","moodle")+" _MENU_ "+M.util.get_string("entries","moodle"),paginate:{first:M.util.get_string("first","moodle"),previous:M.util.get_string("previous","moodle"),next:M.util.get_string("next","moodle"),last:M.util.get_string("last","moodle")}},ajax:function(e,s,a){i(e.search.value,e.length,e.start,e.order[0]).done(function(e){if(0==e.recordsTotal)return e.data=[],void s(e);e.data=function(e){var a=[];return e.forEach(function(e){var s={};s.index='<div class="w-50" tabindex="0">'+e.index+"</div>",0<e.enrolledStudents?s.course='<div class="wdm_course_name has-student" data-courseid="'+e.id+'"><a href="javascript:void(0)">'+e.fullname+"</a></div>":s.course='<div class="wdm_course_name" data-courseid="'+e.id+'" >'+e.fullname+"</div>",s.startdate=e.startdate,s.students='<div class="w-100"><span class="w-full pl-40">'+e.enrolledStudents+"</span></div>",s.progress='\n            <td class="w-100 px-10">\n                <div class="pie-progress pie-progress-xs m-0 w-35" data-plugin="pieProgress" data-valuemax="50" data-barcolor="#11c26d" data-size="20" data-barsize="3" data-goal="35" aria-valuenow="'+e.percentage+'" role="progressbar" style="max-width: 35px!important;">\n                    <div class="pie-progress-content" style="z-index:2;">\n                    </div>\n                    <span class=" progress-percent" style="margin-left: 50px;position: absolute;top: 8px;">'+e.percentage+"%</span>\n                </div>\n            </td>",a.push(s)}),a}(e.courses),s(e)}).fail(n.exception)},columns:[{data:"index"},{data:"course"},{data:"startdate"},{data:"students",orderable:!1},{data:"progress",orderable:!1}],responsive:!0,drawCallback:function(e){d()}})}(e),a(e)})}}});