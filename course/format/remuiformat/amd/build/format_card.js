define(["jquery","core/ajax","format_remuiformat/jquery.dragsort"],function(t,e){return{init:function(){function o(t){var e=t.changedTouches[0],o=document.createEvent("MouseEvent");o.initMouseEvent({touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup"}[t.type],!0,!0,window,1,e.screenX,e.screenY,e.clientX,e.clientY,!1,!1,!1,!1,0,null),e.target.dispatchEvent(o),t.preventDefault()}t(document).ready(function(){t("a.wdm-drag-drop").each(function(t,e){var i=e;i.addEventListener("touchstart",o,!0),i.addEventListener("touchmove",o,!0),i.addEventListener("touchend",o,!0),i.addEventListener("touchcancel",o,!0)})});var i=function(t){if(t.length>0){var e,o=[];t.css("min-height","initial"),t.each(function(t,i){e=(e=i.offsetHeight)>200?e:200,o.push(e)}),e=Math.max.apply(null,o)+55,t.css("min-height",e)}};function n(t){var e,o,i=decodeURIComponent(window.location.search.substring(1)).split("&");for(o=0;o<i.length;o++)if((e=i[o].split("="))[0]===t)return void 0===e[1]||e[1]}t(window).resize(function(){i(t(".single-card"))}),t("form.togglecompletion button").on("click",function(){var e=t(this).closest("form").find('input[name="id"]').val();e&&("Completed"==t(".wdm-completion-status-"+e).text().trim()?(t(".wdm-completion-status-"+e).html(M.util.get_string("markcomplete","format_remuiformat")),t(".activity-check-"+e).removeClass("completed")):(t(".wdm-completion-status-"+e).html(M.util.get_string("completed","format_remuiformat")),t(".activity-check-"+e).addClass("completed")),t(this).closest(".wdm-completion-container").toggleClass("text-muted"))}),t(".form.togglecompletion").submit(function(t){t.preventDefault()}),i(t(".single-card")),t("#page-course-view-remuiformat span.section-modchooser-link").addClass("btn btn-primary"),t(".single-card").css({opacity:0,visibility:"visible"}).animate({opacity:1},600,"swing"),t(".wdm-section-wrapper").dragsort({dragSelector:"a.wdm-drag-drop",dragBetween:!0,dragEnd:function(){var o=t(this).data("section"),i=n("id"),a=t(".wdm-section-wrapper li").map(function(){return t(this).data("id")}).get().toString();e.call([{methodname:"format_remuiformat_move_activities",args:{courseid:i,sectionid:o,sequence:a}}])[0].done(function(t){})},placeHolderTemplate:"<li class='placeHolder' style='border:1px solid gray;'></li>"}),M.course=M.course||{},M.course.format=M.course.format||{},M.course.format.get_config=function(){return{container_node:"ul",container_class:"cards",section_node:"li",section_class:"section"}},M.course.format.swap_sections=function(t,e,o){var i="course-content",n="section_add_menus",a=t.Node.all("."+i+" "+M.course.format.get_section_selector(t));a.item(e).one("."+n).swap(a.item(o).one("."+n))},M.course.format.process_sections=function(t,e,o,i,n){var a="sectionname",c=".left .section-handle .icon";if("move"==o.action){if(i>n){var s=n;n=i,i=s}for(var r,d,m,l,u=i;u<=n;u++){var f=t.Node.create("<span>"+o.sectiontitles[u]+"</span>");e.item(u).all("."+a).setHTML(f),m=(d=(r=e.item(u).one(c)).getAttribute("alt")).lastIndexOf(" "),l=d.substr(0,m+1)+u,r.setAttribute("alt",l),r.setAttribute("title",l)}}},t(".wdm-section-wrapper .single-card-container .wdm-activity-actions .wdm-show-in-row").on("click",function(){var o=n("id"),i=t(this).data("wdmsectionid"),a=t(this).data("wdmactivityid"),c=t(this);e.call([{methodname:"format_remuiformat_show_activity_in_row",args:{courseid:o,sectionid:i,activityid:a}}])[0].done(function(e){t(c).addClass("bg-primary"),t(".wdm-change-layout-notify").show(),t(".wdm-change-layout-notify").delay(2e3).fadeOut("slow")})})}}});
